                      Testing Procedure for New CMUs (rev 61 or later)
                      ================================================

If a CMU fails any test, put a coloured sticker on it with the number and letter 
of the step it failed.


0) Prepare the power supply with between 3.42 V and 3.48 V with its current
   limit set to about 3 A.
   Have a multimeter (not the Fluke 87 III, e.g the Tenma analog) on 10 A range 
   monitoring supply current.
   Use the Fluke 87 III multimeter to monitor supply voltage by plugging its leads
   into the white connector on the test jig.
   Set oscilloscope to 1 V/div, 100 us/div, normal trigger, trigger at about 1.7 V.
   Launch the IAR Workbench software. Open its celltopbmu.eww workspace and
   choose the TestICal project and connect the Launch Pad programming device to the
   right hand USB port.
   Launch TeraTerm and connect the Novus RS485 device to the left hand USB port.
1) Place the board to be tested with its beepers down and with the
   "Cell Management Unit" text reading the right way 'round.
   Connect the communications plugs (in and out) to the pairs of holes at the
   north (TX) and south (RX) ends. Use rubber bands on comms headers.
   Connect power to all Cell Monitoring Units (CMUs) with the alligator clips.
   Wait for the current to fall to less than 0.020 A. No LEDs should be lit.
2) Unplug the red probe of the Fluke 87 III from the white socket, and for each CMU,
   use it to check the voltage at JTAG+ (the rightmost hole of the group of 4).
   They should all read between 2.47 and 2.53 V. Put probe back in white socket.
3) Use the netbook's taskbar (bottom of screen) to choose the icon that looks
   like a spanner and screwdriver (IAR Workbench).
   Use the "Launchpad" programming device to program each CMU in turn,
   by inserting its 4 pin plug part way into the group of 4 holes on the CMU,
   red side furthest from square pad, and tilting it and applying some pressure.
   In IAR Workbench type <Alt+p>wd
   (or choose menu "Project/Download/Download active program").
   Wait for it to complete before moving to the next CMU. If there is an error,
   you may need to unplug the USB connector, wait a few seconds and replug it.
4) Use the netbook's taskbar (bottom of screen) to choose the icon that looks like
   a computer with a "VT" on its screen (TeraTerm). Clip the oscilloscope probe alligator 
   clip to the negative bolt on the test jig. Press the oscilloscope probe tip
   against the southwest pin of the part marked (OP1) in the southeast corner of each CMU.
   Hold down the <Shift>+U keys to send auto-repeated U characters and observe
   approximate square waves with some rounded corners.
   The first CMU will be closer to 50/50 hi/lo as it is not being driven by a previous CMU.
   Apart from that, they should all look the same.
5) Type <Ctrl-s>1i<Enter><Ctrl-q> to set the IDs. You will see ---i where --- is 
   one more than the ID of the last CMU.
   Type 0'lwu (zero tick lowercase-LWU) to turn on link voltage measurement for all CMUs, 
   and to save the IDs.
6) Type v<Enter> to check that the last ID is correct (first_ID + number_in_string - 1),
   and that all blue LEDs are working.

<page break>

7) For each CMU:
  a) Type <n>x<enter> where <n> is the number of the CMU, to address the CMU on its own.
     Don't worry if <n> doesn't show.
  b) Use the v command to verify that only the current CMU's blue light comes on.
     If not, <escape><enter> and re-do the x command.
  c) Use both probes of the Fluke 87 III multimeter to measure the voltage directly 
     at the CMU's + and - terminals pads.
     Use the <nnnn>'vc command to calibrate the voltage based on the multimeter reading.
     Check that the calibration
     value is in the ranges -31500 to -32768 or 31500 to 32767. Check the voltage
     reading with v command.
  d) Use the <nn>'tc command to calibrate the temperature based on a reading of the
     microcontroller (U1) with the non-contact thermometer. Check with t command.
  e) Skip this for now: Use the l command to read link voltage; it should read 1500 +- 100.
     You may need 0p.
  f) Skip this for now: Short the LI (Link In) pin to ground and run another l command.
     Then remove pin. It should read -500 +- 100.
  g) Use 1y to turn on bypass. Supply current should go to 0.55-0.7 A, yellow LED should
     light.
  h) Use 0y1e <enter> to simulate an error. The red LED should light, beeper should sound.
  i) Push the "Hz" button on the Fluke 87 III multimeter and put its lead on the active 
     beeper pin to measure the beeper frequency. Use the 'o' for 'octave' command, repeated 
     as necessary, to choose the loudest frequency.
     This can usually be done by placing the beeper frequency in one of two ranges:
     For the 17 mm beeper (PS1740P02E): 1.15 to 1.4 kHz or 2.8 to 4.6 kHz.
     For the 13 mm beeper (PKM13EPYH4000): 1.3 to 1.7 kHz or 3.4 to 5.2 kHz.
     Use 0e to turn the beeper off.
  j) Move the multimeter lead to the left hole of P3 (TX-). Use the 'f' command and read
     the frequency. You may find it easier to use 2 or more 'f' commands so the reading
     is stable for longer. The reading should be between 199.5 and 200.5 kHz at 20 degC
     (200.5 to 201.5 kHz at 30 degC).
     Push the "Hz" button on the multimeter twice to go back to voltage measurement.
  k) Use u<enter> to update the calibration values.
     The u is very important otherwise all the above work will be lost.
  l) Type the <ESC> key (upper left corner of keyboard).
     This cancels the previous <n>x command.
  m) Go back to the start of step 7 until all CMUs are done.

8) Test break-to-reset with 1e then <Alt-b> (send break). All red LEDs should go off.
9) Test for false break-to-reset with 1Q1e<Enter> then use TeraTerm's Send File command
   in binary mode and with no delays between characters, to send the file
   "Documents/EV/celltopbmu/PCB/NullsTest.txt". All red LEDs should stay on.
10) Test for excessive quiescent current by ensuring all LEDs are off and removing
   an alligator clip from each CMU in turn and inserting a multimeter on 300 mA range.
   The quiescent current (after supercap has charged) should be between 1.7 and 2.1 mA.
   (was less than 1.0 mA for pre-rev 61 CMUs). Disconnect comms from the last CMU as
   the Novus device may be pumping up the supply.
11) First disconnect the CMU board from the test jig, then turn off the power supply.
